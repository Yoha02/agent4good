<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Reports - Health & Environmental Platform</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: {
                            50: '#e6eef5',
                            100: '#ccdde9',
                            200: '#99bbd3',
                            300: '#6699bd',
                            400: '#3377a7',
                            500: '#1a3a52',
                            600: '#152e41',
                            700: '#102331',
                            800: '#0a1720',
                            900: '#050c10',
                        },
                        emerald: {
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Anime.js for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyALQGawG7iVNjJhG8v5w3Z_eyt5oRdMCvk&libraries=places&callback=initializeGoogleMaps" async defer></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .font-display {
            font-family: 'Space Grotesk', sans-serif;
        }
        #threejs-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .glass-dark {
            background: rgba(26, 58, 82, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .report-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .form-section {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .image-preview {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            aspect-ratio: 16/9;
            background: linear-gradient(45deg, #f3f4f6, #e5e7eb);
        }
        
        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-image {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }
        
        .severity-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .severity-low { background-color: #10b981; }
        .severity-moderate { background-color: #f59e0b; }
        .severity-high { background-color: #ef4444; }
        .severity-critical { background-color: #7c2d12; }
        
        .upload-zone {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            transition: all 0.3s ease;
            min-height: 150px;
        }
        
        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }
        
        .form-input {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
            backdrop-filter: blur(10px);
        }
        
        .form-input:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .success-animation {
            animation: successPulse 2s ease-in-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

    <!-- Three.js Background -->
    <canvas id="threejs-bg"></canvas>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass-dark">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-xl flex items-center justify-center animate-pulse">
                        <i class="fas fa-heartbeat text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-white font-display font-bold text-xl">Health & Wellness</h1>
                        <p class="text-gray-300 text-xs">Community Platform</p>
                    </div>
                </div>
                
                <!-- Navigation Links -->
                <div class="hidden md:flex space-x-8">
                    <a href="/" onclick="window.location.href='/'; return false;" class="nav-link text-gray-300 hover:text-emerald-400 transition-colors duration-300 font-medium cursor-pointer">
                        <i class="fas fa-chart-line mr-2"></i>Dashboard
                    </a>
                    <a href="/" onclick="window.location.href='/'; return false;" class="nav-link text-gray-300 hover:text-emerald-400 transition-colors duration-300 font-medium cursor-pointer">
                        <i class="fas fa-wind mr-2"></i>Air Quality
                    </a>
                    <a href="/" onclick="window.location.href='/'; return false;" class="nav-link text-gray-300 hover:text-emerald-400 transition-colors duration-300 font-medium cursor-pointer">
                        <i class="fas fa-virus mr-2"></i>Infectious Diseases
                    </a>
                    <a href="/" onclick="window.location.href='/'; return false;" class="nav-link text-gray-300 hover:text-emerald-400 transition-colors duration-300 font-medium cursor-pointer">
                        <i class="fas fa-robot mr-2"></i>AI Insights
                    </a>
                </div>
                
                <!-- CTA Buttons -->
                <div class="hidden md:flex space-x-4">
                    <button onclick="window.location.href='/report'" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 flex items-center space-x-2">
                        <i class="fas fa-flag"></i>
                        <span>Report Issue</span>
                    </button>
                    <button onclick="window.location.href='/officials-login'" class="bg-navy-600 hover:bg-navy-700 text-white px-6 py-2 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 flex items-center space-x-2">
                        <i class="fas fa-user-shield"></i>
                        <span>Officials Login</span>
                    </button>
                    <button class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105">
                        Get Alerts
                    </button>
                </div>
                
                <!-- Mobile Menu Button -->
                <button class="md:hidden text-white" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="md:hidden hidden bg-navy-800/95 backdrop-blur-lg border-t border-white/20">
            <div class="px-4 py-4 space-y-3">
                <a href="/" onclick="window.location.href='/'; return false;" class="block text-gray-300 hover:text-emerald-400 transition-colors duration-300 font-medium py-2 cursor-pointer">
                    <i class="fas fa-chart-line mr-3"></i>Dashboard
                </a>
                <a href="/" onclick="window.location.href='/'; return false;" class="block text-gray-300 hover:text-emerald-400 transition-colors duration-300 font-medium py-2 cursor-pointer">
                    <i class="fas fa-wind mr-3"></i>Air Quality
                </a>
                <a href="/" onclick="window.location.href='/'; return false;" class="block text-gray-300 hover:text-emerald-400 transition-colors duration-300 font-medium py-2 cursor-pointer">
                    <i class="fas fa-virus mr-3"></i>Infectious Diseases
                </a>
                <a href="/" onclick="window.location.href='/'; return false;" class="block text-gray-300 hover:text-emerald-400 transition-colors duration-300 font-medium py-2 cursor-pointer">
                    <i class="fas fa-robot mr-3"></i>AI Insights
                </a>
                <div class="pt-4 border-t border-white/20 space-y-2">
                    <button onclick="window.location.href='/report'" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                        <i class="fas fa-flag mr-2"></i>Report Issue
                    </button>
                    <button onclick="window.location.href='/officials-login'" class="w-full bg-navy-600 hover:bg-navy-700 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                        <i class="fas fa-user-shield mr-2"></i>Officials Login
                    </button>
                    <button class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                        Get Alerts
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative pt-32 pb-20 overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16 animate-fade-in">
                <h2 class="font-display text-5xl md:text-7xl font-bold text-navy-700 mb-6">
                    Community
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-500 to-emerald-600">
                        Reports
                    </span>
                </h2>
                <p class="text-xl md:text-2xl text-gray-600 max-w-3xl mx-auto">
                    Help protect your community by reporting health symptoms, environmental hazards, and weather incidents
                </p>
            </div>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div class="stat-card bg-white rounded-2xl shadow-xl p-6 border-l-4 border-emerald-500 transform hover:scale-105 transition-all duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-semibold uppercase tracking-wide">Community Powered</p>
                            <h3 class="text-2xl font-bold text-navy-700 mt-2">Real-time Data</h3>
                        </div>
                        <div class="w-14 h-14 bg-emerald-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-users text-emerald-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card bg-white rounded-2xl shadow-xl p-6 border-l-4 border-blue-500 transform hover:scale-105 transition-all duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-semibold uppercase tracking-wide">Response Time</p>
                            <h3 class="text-2xl font-bold text-navy-700 mt-2">< 24 Hours</h3>
                        </div>
                        <div class="w-14 h-14 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-clock text-blue-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card bg-white rounded-2xl shadow-xl p-6 border-l-4 border-purple-500 transform hover:scale-105 transition-all duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-semibold uppercase tracking-wide">Privacy</p>
                            <h3 class="text-2xl font-bold text-navy-700 mt-2">Anonymous Option</h3>
                        </div>
                        <div class="w-14 h-14 bg-purple-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-shield-alt text-purple-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Report Form -->
    <section class="py-16 relative z-20">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <form id="reportForm" class="report-form rounded-2xl shadow-2xl p-8 md:p-12 border border-white/20">
                <!-- Form Header -->
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Submit a Community Report</h2>
                    <p class="text-gray-600">Your report helps us track and respond to health and environmental issues in your area</p>
                </div>

                <!-- Location Information -->
                <div class="form-section rounded-xl p-6 mb-8 border border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-map-marker-alt mr-3 text-blue-600"></i>
                        Location
                    </h3>
                    
                    <!-- Location Search with Autocomplete (Primary - Required) -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Search Location <span class="text-red-500">*</span>
                        </label>
                        <div class="flex gap-3">
                            <div class="flex-1 relative">
                                <input 
                                    type="text" 
                                    id="locationSearchInput"
                                    class="form-input w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-lg" 
                                    placeholder="Enter address, city, ZIP code, or landmark..." 
                                    required
                                >
                                <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                            <button 
                                type="button"
                                id="useMyLocationBtn"
                                class="bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2 whitespace-nowrap"
                            >
                                <i class="fas fa-location-arrow"></i>
                                <span>Use My Location</span>
                            </button>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">
                            <i class="fas fa-info-circle mr-1"></i>
                            Search powered by Google Maps - supports addresses, landmarks, ZIP codes, cities
                        </p>
                    </div>

                    <!-- Auto-populated Location Info (Read-only) -->
                    <div id="autoLocationInfo" class="hidden mb-6 p-4 bg-emerald-50 border border-emerald-200 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Address:</span>
                                <span id="detectedAddress" class="font-semibold text-gray-800 ml-2 block mt-1">-</span>
                            </div>
                            <div>
                                <span class="text-gray-600">City:</span>
                                <span id="detectedCity" class="font-semibold text-gray-800 ml-2 block mt-1">-</span>
                            </div>
                            <div>
                                <span class="text-gray-600">State:</span>
                                <span id="detectedState" class="font-semibold text-gray-800 ml-2 block mt-1">-</span>
                            </div>
                            <div>
                                <span class="text-gray-600">ZIP:</span>
                                <span id="detectedZip" class="font-semibold text-gray-800 ml-2 block mt-1">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden fields for form submission -->
                    <input type="hidden" name="address" id="addressInput">
                    <input type="hidden" name="city" id="cityInput" required>
                    <input type="hidden" name="state" id="stateInput" required>
                    <input type="hidden" name="county" id="countyInput">
                    <input type="hidden" name="zipCode" id="zipCodeInput" required>
                    <input type="hidden" name="latitude" id="latitudeInput">
                    <input type="hidden" name="longitude" id="longitudeInput">
                </div>

                <!-- Report Type Selection -->
                <div class="form-section rounded-xl p-6 mb-8 border border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-list-alt mr-3 text-blue-600"></i>
                        Report Type
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="report-type-option cursor-pointer">
                            <input type="radio" name="reportType" value="health" class="hidden" required>
                            <div class="border-2 border-gray-200 rounded-lg p-4 transition-all hover:border-blue-400 hover:bg-blue-50">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-heartbeat text-2xl text-red-500 mr-3"></i>
                                    <span class="font-semibold text-gray-800">Health Symptoms</span>
                                </div>
                                <p class="text-sm text-gray-600">Respiratory issues, allergic reactions, illness outbreaks</p>
                            </div>
                        </label>
                        
                        <label class="report-type-option cursor-pointer">
                            <input type="radio" name="reportType" value="environmental" class="hidden" required>
                            <div class="border-2 border-gray-200 rounded-lg p-4 transition-all hover:border-green-400 hover:bg-green-50">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-leaf text-2xl text-green-500 mr-3"></i>
                                    <span class="font-semibold text-gray-800">Environmental</span>
                                </div>
                                <p class="text-sm text-gray-600">Air quality, water issues, pollution, hazardous materials</p>
                            </div>
                        </label>
                        
                        <label class="report-type-option cursor-pointer">
                            <input type="radio" name="reportType" value="weather" class="hidden" required>
                            <div class="border-2 border-gray-200 rounded-lg p-4 transition-all hover:border-blue-400 hover:bg-blue-50">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-cloud-rain text-2xl text-blue-500 mr-3"></i>
                                    <span class="font-semibold text-gray-800">Weather Incident</span>
                                </div>
                                <p class="text-sm text-gray-600">Severe weather, flooding, extreme temperatures</p>
                            </div>
                        </label>
                        
                        <label class="report-type-option cursor-pointer">
                            <input type="radio" name="reportType" value="emergency" class="hidden" required>
                            <div class="border-2 border-gray-200 rounded-lg p-4 transition-all hover:border-red-400 hover:bg-red-50">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-exclamation-triangle text-2xl text-red-500 mr-3"></i>
                                    <span class="font-semibold text-gray-800">Emergency</span>
                                </div>
                                <p class="text-sm text-gray-600">Fire, chemical spills, gas leaks, infrastructure damage</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Incident Details -->
                <div class="form-section rounded-xl p-6 mb-8 border border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-info-circle mr-3 text-blue-600"></i>
                        Incident Details
                    </h3>
                    
                    <!-- Severity Level -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Severity Level</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="severity-option cursor-pointer">
                                <input type="radio" name="severity" value="low" class="hidden" required>
                                <div class="border-2 border-gray-200 rounded-lg p-3 text-center transition-all hover:border-green-400">
                                    <div class="severity-indicator severity-low mx-auto mb-2"></div>
                                    <span class="text-sm font-medium">Low</span>
                                </div>
                            </label>
                            <label class="severity-option cursor-pointer">
                                <input type="radio" name="severity" value="moderate" class="hidden" required>
                                <div class="border-2 border-gray-200 rounded-lg p-3 text-center transition-all hover:border-yellow-400">
                                    <div class="severity-indicator severity-moderate mx-auto mb-2"></div>
                                    <span class="text-sm font-medium">Moderate</span>
                                </div>
                            </label>
                            <label class="severity-option cursor-pointer">
                                <input type="radio" name="severity" value="high" class="hidden" required>
                                <div class="border-2 border-gray-200 rounded-lg p-3 text-center transition-all hover:border-red-400">
                                    <div class="severity-indicator severity-high mx-auto mb-2"></div>
                                    <span class="text-sm font-medium">High</span>
                                </div>
                            </label>
                            <label class="severity-option cursor-pointer">
                                <input type="radio" name="severity" value="critical" class="hidden" required>
                                <div class="border-2 border-gray-200 rounded-lg p-3 text-center transition-all hover:border-red-600">
                                    <div class="severity-indicator severity-critical mx-auto mb-2"></div>
                                    <span class="text-sm font-medium">Critical</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Specific Type (Dynamic based on report type) -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Specific Issue</label>
                        <select name="specificType" id="specificType" class="form-input w-full px-4 py-3 rounded-lg border focus:outline-none transition-all" required>
                            <option value="">Select issue type</option>
                        </select>
                    </div>

                    <!-- Description -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea name="description" rows="4" class="form-input w-full px-4 py-3 rounded-lg border focus:outline-none transition-all resize-none" placeholder="Describe what you observed, when it started, and any other relevant details..." required></textarea>
                    </div>

                    <!-- Number of People Affected -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">People Affected (estimated)</label>
                            <select name="peopleAffected" class="form-input w-full px-4 py-3 rounded-lg border focus:outline-none transition-all">
                                <option value="">Select range</option>
                                <option value="1">Just me</option>
                                <option value="2-5">2-5 people</option>
                                <option value="6-10">6-10 people</option>
                                <option value="11-25">11-25 people</option>
                                <option value="26-50">26-50 people</option>
                                <option value="50+">More than 50 people</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">When did this occur?</label>
                            <select name="timeframe" class="form-input w-full px-4 py-3 rounded-lg border focus:outline-none transition-all" required>
                                <option value="">Select timeframe</option>
                                <option value="now">Happening now</option>
                                <option value="1hour">Within the last hour</option>
                                <option value="today">Earlier today</option>
                                <option value="yesterday">Yesterday</option>
                                <option value="week">Within the past week</option>
                                <option value="ongoing">Ongoing issue</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Photo/Video Upload -->
                <div class="form-section rounded-xl p-6 mb-8 border border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-camera mr-3 text-blue-600"></i>
                        Photos & Videos (Optional)
                    </h3>
                    <p class="text-sm text-gray-600 mb-4">Upload up to 10 photos or videos to help document the issue</p>
                    
                    <!-- Upload Zone -->
                    <div id="uploadZone" class="upload-zone flex flex-col items-center justify-center cursor-pointer">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-lg font-medium text-gray-600 mb-2">Drag & drop photos/videos here</p>
                        <p class="text-sm text-gray-500">or click to select files</p>
                        <p class="text-xs text-gray-400 mt-2">PNG, JPG, MP4, MOV up to 50MB each (max 10 files)</p>
                    </div>
                    
                    <input type="file" id="photoInput" accept="image/*,video/*" multiple class="hidden">
                    
                    <!-- Media Previews -->
                    <div id="photoPreview" class="grid grid-cols-2 md:grid-cols-5 gap-4 mt-6 hidden">
                        <!-- Dynamic media previews will be inserted here -->
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="form-section rounded-xl p-6 mb-8 border border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-user mr-3 text-blue-600"></i>
                        Contact Information (Optional)
                    </h3>
                    <p class="text-sm text-gray-600 mb-4">Provide your contact information if you'd like updates on this report</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                            <input type="text" name="contactName" class="form-input w-full px-4 py-3 rounded-lg border focus:outline-none transition-all" placeholder="Your name">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" name="contactEmail" class="form-input w-full px-4 py-3 rounded-lg border focus:outline-none transition-all" placeholder="your@email.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                            <input type="tel" name="contactPhone" class="form-input w-full px-4 py-3 rounded-lg border focus:outline-none transition-all" placeholder="(555) 123-4567">
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="anonymous" name="anonymous" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <label for="anonymous" class="ml-2 text-sm text-gray-700">Submit anonymously</label>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="text-center">
                    <button type="submit" class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 flex items-center mx-auto">
                        <i class="fas fa-paper-plane mr-3"></i>
                        Submit Report
                        <div class="ml-3 hidden animate-spin">
                            <i class="fas fa-spinner"></i>
                        </div>
                    </button>
                    
                    <p class="text-sm text-gray-500 mt-4">
                        Your report will be reviewed and may be shared with relevant authorities
                    </p>
                </div>
            </form>
        </div>
    </section>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center success-animation">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-2xl text-green-600"></i>
            </div>
            <h3 class="text-xl font-semibold text-gray-800 mb-2">Report Submitted!</h3>
            <p class="text-gray-600 mb-6">Thank you for helping keep our community safe. Your report has been received and will be reviewed.</p>
            <button id="closeModal" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                Close
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-navy-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <h3 class="font-bold text-xl mb-4">Health & Wellness Platform</h3>
                    <p class="text-gray-400">Empowering communities with real-time health data and AI insights.</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Features</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="/#air-quality" class="hover:text-emerald-400 transition-colors">Air Quality</a></li>
                        <li><a href="/#infectious" class="hover:text-emerald-400 transition-colors">Disease Tracking</a></li>
                        <li><a href="/#insights" class="hover:text-emerald-400 transition-colors">AI Insights</a></li>
                        <li><a href="/report" class="hover:text-emerald-400 transition-colors">Report Issue</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Resources</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" class="hover:text-emerald-400 transition-colors">Documentation</a></li>
                        <li><a href="#" class="hover:text-emerald-400 transition-colors">API</a></li>
                        <li><a href="#" class="hover:text-emerald-400 transition-colors">Community</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Connect</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-emerald-500 transition-colors">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-emerald-500 transition-colors">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-emerald-500 transition-colors">
                            <i class="fab fa-linkedin"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-800 pt-8 text-center text-gray-400">
                <p>&copy; 2025 Agents for Impact - Community Health & Wellness Platform</p>
                <p class="mt-2">Powered by Google Cloud, BigQuery, and Gemini AI</p>
            </div>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-navy-900/90 hidden items-center justify-center z-50">
        <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-emerald-500 mb-4"></div>
            <p class="text-white text-xl font-semibold">Loading...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/three-bg.js') }}"></script>
    <script src="{{ url_for('static', filename='js/animations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/report-form.js') }}"></script>

    <!-- Google Maps Autocomplete & Auto-Location Script -->
    <script>
        // Report page location handling - variables in global scope for Google Maps callback
        let reportAutocomplete;
        let reportGeocoder;

        // Initialize Google Maps Places Autocomplete - MUST be global for callback
        function initializeGoogleMaps() {
            console.log('üó∫Ô∏è Initializing Google Maps autocomplete for report page...');
            
            const input = document.getElementById('locationSearchInput');
            if (!input) {
                console.error('‚ùå Location search input not found!');
                return;
            }

            // Initialize autocomplete
            reportAutocomplete = new google.maps.places.Autocomplete(input, {
                componentRestrictions: { country: 'us' },
                fields: ['address_components', 'formatted_address', 'geometry', 'name'],
                types: ['geocode', 'establishment']
            });

            // Initialize geocoder for reverse geocoding
            reportGeocoder = new google.maps.Geocoder();

            // Handle place selection
            reportAutocomplete.addListener('place_changed', handlePlaceSelect);

            console.log('‚úÖ Google Maps autocomplete initialized');
        }

        // Handle place selection from autocomplete
        function handlePlaceSelect() {
            const place = reportAutocomplete.getPlace();
            
            if (!place.geometry) {
                console.error('‚ùå No geometry data for selected place');
                return;
            }

            console.log('üìç Place selected:', place);

            // Extract address components
            let streetNumber = '';
            let route = '';
            let city = '';
            let state = '';
            let county = '';
            let zipCode = '';
            let country = '';

            if (place.address_components) {
                place.address_components.forEach(component => {
                    const types = component.types;
                    
                    if (types.includes('street_number')) {
                        streetNumber = component.long_name;
                    }
                    if (types.includes('route')) {
                        route = component.long_name;
                    }
                    if (types.includes('locality')) {
                        city = component.long_name;
                    }
                    if (types.includes('administrative_area_level_2')) {
                        county = component.long_name;
                    }
                    if (types.includes('administrative_area_level_1')) {
                        state = component.short_name;
                    }
                    if (types.includes('postal_code')) {
                        zipCode = component.long_name;
                    }
                    if (types.includes('country')) {
                        country = component.short_name;
                    }
                });
            }

            // Build street address
            const streetAddress = [streetNumber, route].filter(x => x).join(' ');

            // Update form fields
            updateLocationFields({
                address: streetAddress || place.formatted_address || place.name,
                city: city,
                state: state,
                county: county,
                zipCode: zipCode,
                latitude: place.geometry.location.lat(),
                longitude: place.geometry.location.lng()
            });
        }

        // Auto-detect user's location on page load
        function autoDetectLocation() {
            console.log('üåç Attempting auto-location detection...');

            if (!navigator.geolocation) {
                console.warn('‚ö†Ô∏è Geolocation not supported by browser');
                return;
            }

            const useMyLocationBtn = document.getElementById('useMyLocationBtn');
            if (useMyLocationBtn) {
                useMyLocationBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Detecting...';
                useMyLocationBtn.disabled = true;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    console.log('‚úÖ Geolocation successful:', position.coords);
                    
                    // Wait for geocoder to be ready before reverse geocoding
                    const waitForGeocoder = setInterval(() => {
                        if (reportGeocoder) {
                            clearInterval(waitForGeocoder);
                            reverseGeocode(position.coords.latitude, position.coords.longitude);
                        } else {
                            console.log('‚è≥ Waiting for Google Maps geocoder to initialize...');
                        }
                    }, 100);
                    
                    // Timeout after 10 seconds
                    setTimeout(() => {
                        clearInterval(waitForGeocoder);
                        if (!reportGeocoder) {
                            console.error('‚ùå Geocoder initialization timeout');
                            if (useMyLocationBtn) {
                                useMyLocationBtn.innerHTML = '<i class="fas fa-location-arrow"></i> Use My Location';
                                useMyLocationBtn.disabled = false;
                            }
                        }
                    }, 10000);
                },
                (error) => {
                    console.error('‚ùå Geolocation error:', error.message);
                    if (useMyLocationBtn) {
                        useMyLocationBtn.innerHTML = '<i class="fas fa-location-arrow"></i> Use My Location';
                        useMyLocationBtn.disabled = false;
                    }
                },
                { timeout: 10000, enableHighAccuracy: true }
            );
        }

        // Reverse geocode coordinates to address
        function reverseGeocode(lat, lng) {
            console.log(`üîÑ Reverse geocoding: ${lat}, ${lng}`);

            if (!reportGeocoder) {
                console.error('‚ùå Geocoder not initialized');
                return;
            }

            reportGeocoder.geocode({ location: { lat, lng } }, (results, status) => {
                const useMyLocationBtn = document.getElementById('useMyLocationBtn');
                
                if (status === 'OK' && results[0]) {
                    console.log('‚úÖ Reverse geocode successful:', results[0]);

                    // Extract components from first result
                    let streetNumber = '';
                    let route = '';
                    let city = '';
                    let state = '';
                    let county = '';
                    let zipCode = '';

                    results[0].address_components.forEach(component => {
                        const types = component.types;
                        
                        if (types.includes('street_number')) streetNumber = component.long_name;
                        if (types.includes('route')) route = component.long_name;
                        if (types.includes('locality')) city = component.long_name;
                        if (types.includes('administrative_area_level_2')) county = component.long_name;
                        if (types.includes('administrative_area_level_1')) state = component.short_name;
                        if (types.includes('postal_code')) zipCode = component.long_name;
                    });

                    const streetAddress = [streetNumber, route].filter(x => x).join(' ');

                    // Update location search input
                    const input = document.getElementById('locationSearchInput');
                    if (input) {
                        input.value = results[0].formatted_address;
                    }

                    // Update form fields
                    updateLocationFields({
                        address: streetAddress || results[0].formatted_address,
                        city: city,
                        state: state,
                        county: county,
                        zipCode: zipCode,
                        latitude: lat,
                        longitude: lng
                    });

                    if (useMyLocationBtn) {
                        useMyLocationBtn.innerHTML = '<i class="fas fa-check"></i> Location Set';
                        setTimeout(() => {
                            useMyLocationBtn.innerHTML = '<i class="fas fa-location-arrow"></i> Use My Location';
                            useMyLocationBtn.disabled = false;
                        }, 2000);
                    }
                } else {
                    console.error('‚ùå Reverse geocoding failed:', status);
                    if (useMyLocationBtn) {
                        useMyLocationBtn.innerHTML = '<i class="fas fa-location-arrow"></i> Use My Location';
                        useMyLocationBtn.disabled = false;
                    }
                }
            });
        }

        // Update all location fields in the form
        function updateLocationFields(data) {
            console.log('üìù Updating location fields:', data);

            // Update visible display fields
            const displayElements = {
                detectedAddress: data.address,
                detectedCity: data.city,
                detectedState: data.state,
                detectedZip: data.zipCode
            };

            Object.entries(displayElements).forEach(([id, value]) => {
                const elem = document.getElementById(id);
                if (elem) {
                    elem.textContent = value || '-';
                }
            });

            // Update hidden form inputs
            const inputFields = {
                addressInput: data.address,
                cityInput: data.city,
                stateInput: data.state,
                countyInput: data.county,
                zipCodeInput: data.zipCode,
                latitudeInput: data.latitude,
                longitudeInput: data.longitude
            };

            Object.entries(inputFields).forEach(([id, value]) => {
                const elem = document.getElementById(id);
                if (elem) {
                    elem.value = value || '';
                }
            });

            // Show the auto-populated info panel
            const autoLocationInfo = document.getElementById('autoLocationInfo');
            if (autoLocationInfo && (data.city || data.state || data.zipCode)) {
                autoLocationInfo.classList.remove('hidden');
            }

            console.log('‚úÖ Location fields updated successfully');
        }

        // Wire up "Use My Location" button and auto-detect on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Report page loaded, initializing location features...');
            
            const useMyLocationBtn = document.getElementById('useMyLocationBtn');
            if (useMyLocationBtn) {
                useMyLocationBtn.addEventListener('click', autoDetectLocation);
            }
            
            // Auto-detect location on page load
            console.log('üéØ Starting auto-location detection on page load...');
            autoDetectLocation();
        });
    </script>
</body>
</html>